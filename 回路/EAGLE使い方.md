# EAGLE使い方

- [EAGLE使い方](#eagle使い方)
  - [インストール](#インストール)
  - [特徴](#特徴)
  - [回路図の作成](#回路図の作成)
  - [回路図に部品を追加する](#回路図に部品を追加する)
    - [部品検索](#部品検索)
    - [部品のsymbol・footprint収集](#部品のsymbolfootprint収集)
  - [配線をする](#配線をする)
    - [直接つなぐ場合](#直接つなぐ場合)
    - [ラベルを使う場合](#ラベルを使う場合)
  - [回路図チェック](#回路図チェック)
  - [配線図の生成](#配線図の生成)
  - [部品を配置する](#部品を配置する)
  - [配線する](#配線する)
    - [自動配線の場合](#自動配線の場合)
    - [手動配線の場合](#手動配線の場合)
    - [配線をリセットする](#配線をリセットする)
  - [デザインルールの確認](#デザインルールの確認)
  - [発注](#発注)
    - [製造メーカー](#製造メーカー)
    - [PCBwayの場合](#pcbwayの場合)
  - [基板に絵を入れたい場合](#基板に絵を入れたい場合)
  - [配線の太さと許容電流](#配線の太さと許容電流)
  - [ノイズ対策](#ノイズ対策)
    - [ベタGND](#ベタgnd)


## インストール
[AUTODESKのページから](https://www.autodesk.co.jp/products/eagle/overview?term=1-YEAR&tab=subscription)無償版をダウンロードする

最初にサインインしろと言われるが無視して良い（多分）

EAGLE単品が指定したディレクトリにインストールされるのでインストール先はどこでもいいと思われるが、なぜかプロジェクトやライブラリを保存するフォルダだけCドライブのドキュメントに作成されるようなので自分で分かりやすいディレクトリに移した。これらのフォルダの場所を移した場合、EAGLEにパスを通し直す必要がある。EAGLEを起動するとコントロールパネルと左上に名前が書いてあるウィンドウが出るのでそのメニューバーから「Options->Directories」を選んでパスを通す。

## 特徴
- 無償版は編集できる基板サイズが最大で100mm×80mm (製造代が特に安い中国メーカーのほとんどが、割引対象を100×100までとしているのであまり困らない)
- 使っている人が多いため部品ライブラリが多く。無料で引っ張ってこられるものも多い。
- 自動配線機能がデフォルトで入っている。途中まで手配線残り自動といった形で使ったり、自動配線も配線候補が5パターンくらい提示されるので一番マシなのものを選ぶといったことが可能。

## 回路図の作成
EAGLEは回路図と配線図が分かれていて、先に回路図を作ると配線図に実際の部品パッケージとどことどこを繋ぐかを表した線が出るので、配線図側で部品の配置と導線の太さなどを決めることになる。

最初に編集するためのプロジェクトを作る。画像の赤丸の部分がハイライトされた状態でメニューバーの「File->New->Project」を選択
<img src="/img/project.png" width=500>
プロジェクトファイルの中にschematic(回路図)ファイルとboard(配線図)ファイルが入っている状態がプロジェクトの基本構成である。今度はメニューバーの「File->New->Schematic」をクリック。下のような画面が回路図の編集画面である。
<img src="/img/Schematic.png" width=500>
基本的な操作としては左側のボックスのボタンを押してから部品を配置したり配線をしていくことになる。部品を選択するときは真ん中あたりに十字の印が入っているのでその近くをクリックする。よく使うボタンと役割の例は以下の通り。
- **Info**:これを押したうえで部品をクリックするとその部品のデータ上での名前や座標、傾きといった情報が見られる。テキストを入力できる形式になっているのでそこに直接数字や文字を打ち込めばInfoボタンでも変更可能。また抵抗などの回路素子ではvalue(抵抗なら抵抗値、コンデンサなら電気容量など)も見たり変更することができる。
- **Group**:部品を選択だけする場合などに使う。これを押したうえで部品の十字をクリックすれば部品がハイライトされる。また左クリックした状態で引っ張れば囲った範囲の部品を複数選択できる。何もないところで左クリックをすると灰色の線が出てくるのでそれで選びたい部品だけを囲うこともできる。左クリックで選択範囲の線を曲げ、右クリックで終点。
- **Move**:部品を移動させたい場合に使う。このボタンを押したうえで移動させたい部品の十字部分を押す。
- **Rotate**:90度刻みで部品を回転させることができる。
- **Add Part**:このボタンを押すと部品一覧が開かれる。その中から目的の部品を選ぶと編集画面に戻りマウスで部品を好きな位置に配置できるようになっている。検索ボックスがあるが使い勝手が圧倒的クソなので次の記事で補足する。
- **Net**:これを押すと部品の端子同士を線で結べるようになる。正しいピン同士を配線して回路図を作成していく。配線の途中をクリックすれば新しい分岐をそこから伸ばすことができる。
- **Junction**:Netで引いた線が交差している場合、それらの線は別の線として扱われている。接続したい場合にこのJunctionボタンを選んだうえで交点をクリックすると接続される。(接続されるとその印に丸ポチがそこに付く)
- **Name**:部品に名前をつけることができる。よく見かける慣例はICにIC1,IC2と付けたり抵抗にR1,R2-1と付けたりなど。部品名の最後を数字にするとEAGLE側で連番扱いになる。
- **Value**:主に抵抗やコンデンサ、コイルの素子としての大きさを入力する。10Ωなら10、1uFなら1uといった風に入力する。最悪自分が把握できれば良い。
- **Copy**:名前の通りコピー。ctrl+Cのショートカットでもできる。
- **Paste**:コピーした部品や配線をペーストできる。部品名の最後が数字ならば1つ後の数字に置き換わり連番となる。
- **Delete**:選択した部品や配線を削除できる。キーボードのdeleteキーでも良い。
- **Change**:部品の様々な部分を配置した後から変更できる。ボタンを押すと変更できる項目が出てくるので、1つ選び部品をクリックすると選んだ部品のその項目が後から変更できる。変更できる項目は多いので慣れたら使ってみるくらいでも良い。

## 回路図に部品を追加する
Add Partボタンで部品一覧を選び使いたい部品を選ぶ。抵抗やコンデンサ等はサイズで分かれてるので注意すること。サイズは1608、2014のように表記され、縦横が1.6x0.8,2.0x1.4という意味。また、サイズはインチ表記とミリメートル表記が混ざっているので間違えないように。今使っているのは1608**インチ**
左クリックで配置、右クリックで回転ができる。終了したいときはEscを押す。
<img src="/img/add.png" width=500>
### 部品検索
Add Partボタンで展開する部品リストはゴミなので使い方に慣れる必要がある。検索ボックスには使いたい部品名を入力するが、(確か)全文一致検索がデフォルトであるので欲しい部品名をそのまま入力しても検索に引っかからない。そのため前後をワイルドカード「*」で挟むと使いやすくなる。例えば「BNO055」を探したいが「BNO05」までしか覚えていないといった場合、検索ボックスに「BNO05」と入力しても全文一致検索により候補が出てこないが、「*BNO05*」と入力すれば部分一致する部品候補が出てくるようになる。
### 部品のsymbol・footprint収集
回路図でsymbol、配線図でfootprintを用いるが、最初から部品が用意されていないことがある。その場合は、自分で部品データを集めるか、作成する必要がある。
<img src="/img/footprint.png" width=500>

左がsymbol、右がfootprint
今使っているものはBoxのUAV->に保存している

新しく増やしたければ、ICを調べてECADモデルをダウンロードする。自分がよく使うサイトを一覧にしておく。
- [Mouser](https://www.mouser.jp/)
- [Free PCB Library](https://componentsearchengine.com/?gclid=Cj0KCQiA7bucBhCeARIsAIOwr-_cIxiWsXcVXk4lPbtY2RzGw4Db0WdnrfxMqymXanwLZwmNwUnXUIMaAqxsEALw_wcB)
- [Snap EDA](https://www.snapeda.com/parts/IR2302/Infineon%20Technologies/view-part/?ref=search&t=IR2302#download-modal)

※必要に応じて[Library Loader(ソフト)](https://www.samacsys.com/library-loader/)を使う
.lbrをEAGLE/librariesの中に保存して追加すれば使用できる。
（基本的にEagleを一度閉じないと更新さないので注意）

## 配線をする
### 直接つなぐ場合
いくつか部品をならべた段階で繋ぐべきピン同士をNetでつないでいく。
<img src="/img/net.png" width=500>

### ラベルを使う場合
直接Netで配線しなくても下の画像のように端子から少しだけ配線を伸ばして、Nameボタンを押したうえでその配線をクリックすれば配線に名前が付けられる。(Infoボタンで配線名を変更しようとすると最初の1つ目以外あとは名前被り扱いとなり変更できない。Nameボタンでは同じ配線がすでにあるので繋げますか?という警告にyesを押すと画像のようになる。)
同じ配線名同士は画面上で直接つながっていなくても後の配線図(boardファイル)上では繋がっている。
<img src="/img/label_net.png" width=500>
画像は抵抗の端子にGNDという配線名を付けたところこのときこれらの配線は接続された扱いになっている。
配線に名前を付けるときPlace labelにチェックを入れておけば画像のように配線横にラベルを配置できる。左側ボックスのLabelボタンを使っても同様のことができる。
またよく見るとラベルにも十字のクリック部分がついていることが分かる。Infoボタンを押してラベルの十字をクリックすると項目の中にXrefというチェックボックスがある。これにチェックを入れるとラベルを見やすくすることができる。
<img src="/img/xref.png" width=500>
配線を切りたい場合はその配線を選択してデリートする。部品を消したい場合も同様にデリート。
以上のような操作を繰り返して回路図を作っていく。

## 回路図チェック
最後にERCをクリックしてエラーチェックをかける。
<img src="/img/schematic_ERC.png" width=500>
警告の中にはICにValueを設定していないなど気にしなくてよいものもあるので無視することもある。

## 配線図の生成
回路図左上の回路図/配線図の切り替えボタンを押す。初回は配線図がないので生成しますか？といった内容のテキストにyesを押す。
<img src="/img/change.png" width=500>
以下のような画面になる。
<img src="/img/board.png" width=500>

## 部品を配置する
まずは部品を配置する。画像右側のオレンジ線で囲まれた領域が基板サイズの領域である。線をクリックしてMoveをしたりInfoから直接数字を打ち込むことで線が移動するので基板サイズを変更することができる。移動の最小単位は左上の格子模様のボタンで変更できる。
<img src="/img/grid.png" width=500>
Displayは最小単位を編集画面で表示するかどうか、Styleで格子状かドットかを選べる。入力欄に数字を入力し右側から単位を選ぶ(milやmm)など。Multipleは倍率を表す。AltはAltを押しながら操作する場合の最小単位設定である。これを使えば大体の位置合わせを通常の単位でやりながら微調整をする際にAltキーを使ったり、通常はインチやmil単位だがAltのときだけmm単位系に切り替えるなどができる。
これら設定とMoveボタンを利用して部品を配置していく。
ただし部品の配置先や回転などの操作は、オレンジ線の枠左下にある十字模様を原点として10cm×8cm内の範囲でしかできない(有料版ではこの制限はなくなる)。
部品の配置はMoveボタン、向きの変更はRotateボタン、部品を裏側へ配置する際にはMirrorボタンを使う。
<img src="/img/arrangement.png" width=500>

## 配線する

### 自動配線の場合
autorouterボタンを押してcontinue,startを順に押すだけで配線がされる。評価基準に基づいてマシなものから順番に5つほど候補が表示されるので採用したいものを選んでevaluateを押す。
<img src="/img/autorouter.png" width=500>
<img src="/img/select.png" width=500>
線の太さはEdit->Net classesで変更することができる。Net classesメニューのAddボタンを押してNet classを追加する。AddでNet classを追加するとNo Memberに配線名が表示されるので、同じNet classにまとめたい配線名を選択してMemberに移動させる。
Net classメニューの上側に「Classes」と「Rules」というタブがあるので、Net classの追加が終わったら「Rules」タブに切り替える。「Rules」では配線幅やクリアランスが直接入力できるようになっているので、好きな数字+単位を入力して「OK」を押す。
<img src="/img/auto_rules.png" width=500>

### 手動配線の場合
左側の配線ボタンを押して繋ぎたい2箇所を押すと配線することができる。繋ぐべき場所は、黄色い線で表示されている。上部のWidthで線の太さを変えることができる。また、左上のLayerからTop(表面),Bottom(裏面)を選択することができる。1箇所目を押してからマウスのホイールでクリックするとViaが作成でき、配線が表面から裏面に移動する。
<img src="/img/manual.png" width=500>

### 配線をリセットする
下の画像のようにコマンド欄に「ripup;」と入力してエンターを押す。
<img src="/img/reset.png" width=500>

## デザインルールの確認
まずは、発注先のデザインルールを確認する。
「(発注先) drc」で調べるとだいたい誰かが作ってくれいるはず
.drcをEAGLE/design rulesの中に保存して追加する。
Edit->Design rulesからLoadで発注先.drcを選択するとデザインルールを変更することができる。
<img src="/img/drc.png" width=500>
DRCボタン(デザインルールチェック)を押して配線ミスや業者にデータを渡す際に加工不可能なものになっていないか確認をする。
<img src="/img/board_DRC.png" width=500>
左下にNo errorsと出ればOK
ダメな場合はエラー一覧が出てくる。
エラーの種類としてはair wire(未配線)、overlap(配線が重なっている)、clearance(配線同士や部品同士が近すぎる)　　等
かなり無理してサイズを小さくしているのでKeepoutのエラーが頻発するが半田付けできる幅なら多分大丈夫。

## 発注

### 製造メーカー
- P板.com:国内のメーカー。めちゃくちゃ高い。代引き可能なので楽ではあるけど高い。高いから使ったことない。
- Elecrow:中国メーカー。安くて発注から届くまでが速い。(品質は良くない、5枚頼むと10枚届くことがある。10枚あれば5枚は使えるだろうといった感じ)
- PCBGOGO:中国メーカー。 安くて発注から届くまでが速い。使ったことない。
- PCBWay:PCBGOGOと同じ会社が運営しているらしいが、こちらの方が注文の際の設定が細かく指定できる。現在の発注先
- Fusion PCB:中国seeedのサービス。価格はElecrowと同じくらい。発注から届くまでの時間にばらつきがある(10-30日)が、基板自体の質はElecrowよりマシ。セールをしてるとき(送料込み~12$)に使う。

中国メーカーは中国の暦で休日がある(春節など)ので注意。

### PCBwayの場合
**製造会社ごとに違う可能性があるので他の会社の場合、ちゃんと調べること**（ミスったら製造会社から英語で怒られるかも？）
業者への発注データをガーバーファイルと呼ぶ。ガーバーの出力には、CAMファイルを使う。
<img src="/img/cam.png" width=500>
SeeedFusion_2_layer.camを選択してProcess Jobを押すとガーバーファイルのZipが出力される。Zipは解凍せず、そのまま[PCBwayのページ](https://www.pcbway.jp/QuickOrderOnline.aspx)にアップロードする。
<img src="/img/output.png" width=500>
基板仕様は基本変えない
変更するのは
- 枚数
  値段が変わらない範囲でできるだけ多く(現在のは、15枚まで同じ値段だった)
- 基板の厚み
  軽量化のため、できるだけ薄く(現在のは、0.6 薄すぎると表面処理に制限がかかる)
- 表面処理
  基本的に有鉛はんだレベラー　(表面処理なしだと半田付けが難しくなる）
- 配送会社
  費用と日数で勝手に決めて
  いずれにしろ、箱はボロボロの状態で届く
  DHLとOCSは届いた経験がある（OCSはANA系列らしい）


## 基板に絵を入れたい場合
[このページ](https://www.s-m-l.org/silk_logo.html)を参考にしてね

## 配線の太さと許容電流
一般的には1mmで1Aと言われている。しかし、自分の経験上では1mm(39.4mil)で2Aまでは大丈夫。電流が許容電流を超えている場合は、配線が熱を持ち、銅線が焼き切れる。
目安
- DCモーター:1.5A->30mil
- サーボモータ:1A->20mil
- 信号線:150mA->6mil

ビアを開ける場合も許容電流に注意する必要がある。
目安
- 1A->40mil
- 100mA->4mil
ビアは許容電流が足りない場合、同じ配線に対して複数開けると良い。
配線も2本分けて配線することで許容電流は増加するが、ループができるとアンテナと化す（1巻きコイルと見なせる）のでノイズが発生するのでおすすめしない。

## ノイズ対策
信号線にノイズが発生すると誤動作や破損につながるため、ノイズ対策をする必要がある。しかし、ノイズ対策は種類が多いので詳しくは[このサイト](https://www.noise-counterplan.com/cat_point/cat01/)を見てほしい。ここでは、基本的なことだけ挙げる。
- 配線は直角に曲げない
- 信号線は平行に配線しない
- コンデンサはICの近くに配置する

### ベタGND
プリント基板ではGND線を他の線と同様の単なる配線として引くのではなく、基板の広い領域でべた塗りするように取ることが多い。
最初に画面左側のアイコンの中から「Polygon」ボタンを押し、上側のメニューバーから設定をして基板を囲むようにマウスで四角を書く。メニューバーの設定項目は左側から
- 「Layer」 : ポリゴンを配置するレイヤー
- 「Select Wire Bend 」: ポリゴンの辺の曲げ方
- 「Width 」: ポリゴンの線の太さ
- 3つ並んでいるアイコン : ポリゴン内部の塗りつぶし方
- その横の2つ並んでいるアイコン : 基板端子などとの接続の仕方
- 最後の2つのアイコン : 配線などで孤立した領域の処理
- 「Isolation」 : 他の配線との間隔
- 「Spacing」 : ポリゴンの塗りつぶし方を「Hatched」にした場合のハッチ間隔(ベタ塗りの場合は意味を持たない)
- 「Rank」 : ポリゴン同士が重なった場合の塗りの優先順位
- 「Radius」とその右側のアイコン : ポリゴンの角を丸めるかどうかとその半径
特に無ければ、「Top」、「直角曲げ」、「自分が見やすい太さ」、「塗り方はSolid」、「Thermals off」、「Drop orphans」、「Isolation:0 (0にすると適当に必要な分だけ間隔が確保される)」、「Spacing:Solid塗りなら意味を持たないので弄らなくてよい」、「Rank:優先して塗りたい方を小さく」、「Radius:0」
といった具合に設定すればよい。
<img src="/img/polygon.png" width=500>
ポリゴンで基板を一通り囲った後に始点に合わせてクリックすると形が確定しポリゴンの名前を指定するウィンドウが現れる。ポリゴンの名前を回路中のGNDにあたる配線名と同じにすればベタGNDができる。ポリゴンの各種設定は「Info」ボタンを押したあとにポリゴンの辺をクリックしても変更できる。また、ポリゴンの名前は「Name」からでも変更できる。
<img src="/img/line.png" width=500>
ポリゴンを削除する場合は「Group」ボタンを押してポリゴンが選択できるようにした状態で、辺を左クリック→Deleteでその辺のみが消える。辺を右クリック→「Delete Polygon」でポリゴン全体が消える。
<img src="/img/delete.png" width=500>
ポリゴンの配置が終わったら「Ratsnest」ボタンで塗りつぶされた結果が確認できる。再編集の際に邪魔に感じたら上のコマンド欄に「ripup @;」と打ち込むことでポリゴンによる塗りつぶしだけ解除される。
裏面にも配置する場合は再度「Polygon」ボタンを押し配置前にレイヤーをBottomに設定して基板を囲む。
<img src="/img/ratsnest.png" width=500>
ベタGNDにするとノイズに強くなるが、熱が逃げやすいので半田付けが難しくなる。また、ベタGNDはこの例のように安直に基板全部に適応するべきではない。場合によっては、ベタGNDが原因でノイズが発生してしまうことがある。詳細は[ここ](https://www.noise-counterplan.com/point/395/)見て。