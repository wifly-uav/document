# 回路設計方法

## 環境
* Eagle使用
* PCBWayに発注

## Eagle
頑張ってインストールして
https://www.autodesk.co.jp/products/eagle/free-download
無償で問題ない

他のフリーソフトなら
* KiCad
https://www.kicad.org/

## PCBWay
[PCBWay](https://www.pcbway.com/orderonline.aspx)
実際に基板を作ってくれる会社
他にも
* [Elecrow](https://www.elecrow.com/pcb-manufacturing.html)
* [PCBgogo](https://www.pcbgogo.jp/)
* [P板.COM](https://www.p-ban.com/kiban/com/csComEst.do)
などなど

基本的に中国の会社の方が良い（日本は異常に高い）
製造会社ごとに製造ルールが異なるため、どこに発注するかを設計段階で決めておく必要がある

## 手順
1. 何の基板を作るか決める
基板に乗せる基板、コントローラの基板などなど
2. 回路でやりたいことを挙げる
モーターをX個回したい、サーボをY個繋げたいなど
3. **回路に必要な要件をまとめる(重要!)**
モーターがX個あるから駆動回路がX個必要、センサ用にSPIが必要など
4. **回路に必要なICを選定する(重要！ 難しい!!)**
モーターを回すためにはこのICが必要など
5. ICに必要な周辺回路を確認する
抵抗やコンデンサなどが必要になる(ICのデータシートで確認する)
6. LTSpiceやブレッドボードで動作確認する
やっとけば安心、やらなくても良い
7. 回路に使うICのsymbol・footprintを集める
基板を設計する時に必要、無ければ作る
8. 回路図を作成する
EagleのSchでICのピン同士を繋げる
9. 基板を設計する(難しい!!)
EagleのBrdで基板の配線を行う
10. 基板チェックする
製造会社のルールでチェックを行う
11. 発注する
製造会社のページにデータを送る

## 機体のマイコンを設計したときの例
## 1. 何の基板を作るか決める
機体に搭載するマイコン
## 2. 回路でやりたいことを挙げる
* 無線通信可能
* モーターを2つ回す
* サーボを2つ動かす
* ジャイロセンサを繋げる
* 1sのリポバッテリー(4.2v)で動作する
* 軽量化する
## 3. 回路に必要な要件をまとめる(重要!)
メインチップ
* モーター2つ、サーボ2つを回すためにPWM4つ必要
* ジャイロセンサ用にI2Cを1つ必要
* デバッグLED用にOut pinが1つ必要

周辺回路
* 電源用にレギュレータが必要
* モーター制御のためにパワーMOSFETが2つ必要
* デバッグ用にLEDが1つ必要
## 4. 回路に必要なICを選定する(重要！ 難しい!!)
メインチップ
検討（要件を満たす・手に入るもの）
* ESP-WROOM-02D
* [Twelite](https://mono-wireless.com/jp/products/TWE-Lite-DIP/index.html)
→ESP-CAMを使っていたため、開発環境の観点からESP-WROOM-02Dを採用

周辺回路
- レギュレータ
  - 出力が3.3v
  - ドロップアウト電圧が低いもの(0.5V未満)
  - 最大電流が0.5A以上
  - できるだけ小さい
→[3.3v レギュレータ](https://akizukidenshi.com/catalog/g/gI-17230/)

- MOSFET
  - 許容電流が1.5A以上
  - 3.3V以下で動作
  - オン抵抗が小さい
  - ゲート容量が小さい
  - できるだけ小さい
  →[Pch パワーMOSFET AO3401A](https://akizukidenshi.com/catalog/g/gI-14654/)
  Pchの必要はないNchのAO3400Aでも良い
  配線の都合上、Pchの方がきれいにいったのでPchにした

- LED
  - 特に気にしない、好きな色を使って
  →[黄色チップLED](https://akizukidenshi.com/catalog/g/gI-11880/)

## 5. ICに必要な周辺回路を確認する
- メインチップ
    - それぞれのピンのプルアップ、プルダウン抵抗
    - リセット、ブート用のスイッチ
- レギュレータ
  - 入出力側にコンデンサ
- MOSFET
  - ゲート抵抗
  - プルアップ抵抗
- LED
  - 抵抗

## 6. LTSpiceやブレッドボードで動作確認する
1つ1つの部品ごと(MOSFETのみ等)で動作確認した
全部組んでやるのは面倒なので省略した

## 7以降
EAGLE編に続く